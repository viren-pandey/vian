# VIAN — Mandatory Project Boilerplate
### Every generated project MUST start with these exact files.
### Plant these FIRST before any AI generation begins.
### Do not modify structure. Do not skip any file.

---

## WHY THIS EXISTS

WebContainer boots Next.js correctly ONLY when these files exist
in the correct paths with the correct content.

If ANY of these files is missing, wrong path, or malformed:
- Next.js throws "Couldn't find any pages or app directory"
- Preview stays blank
- npm install hangs or fails
- Tailwind does not compile

Plant ALL files below BEFORE calling the AI generation API.
Then let AI overwrite `app/page.tsx` and `components/` with real content.

---

## FILE 1 — `package.json`

```json
{
  "name": "vian-app",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev":   "next dev",
    "build": "next build",
    "start": "next start",
    "lint":  "next lint"
  },
  "dependencies": {
    "next":      "14.2.5",
    "react":     "18.3.1",
    "react-dom": "18.3.1",
    "clsx":      "2.1.1",
    "lucide-react": "0.395.0"
  },
  "devDependencies": {
    "@types/node":      "20.14.2",
    "@types/react":     "18.3.3",
    "@types/react-dom": "18.3.0",
    "autoprefixer":     "10.4.19",
    "postcss":          "8.4.38",
    "tailwindcss":      "3.4.4",
    "typescript":       "5.4.5"
  }
}
```

> CRITICAL: Use EXACT versions (no ^ or ~).
> Version ranges cause npm install to hang inside WebContainer.

---

## FILE 2 — `next.config.js`

```js
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  async headers() {
    return [
      {
        source: '/(.*)',
        headers: [
          {
            key: 'Cross-Origin-Embedder-Policy',
            value: 'require-corp',
          },
          {
            key: 'Cross-Origin-Opener-Policy',
            value: 'same-origin',
          },
        ],
      },
    ]
  },
}

module.exports = nextConfig
```

> CRITICAL: COOP and COEP headers are REQUIRED for WebContainer.
> Without them WebContainer cannot run at all.

---

## FILE 3 — `tsconfig.json`

```json
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [{ "name": "next" }],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}
```

---

## FILE 4 — `postcss.config.js`

```js
module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
```

---

## FILE 5 — `tailwind.config.ts`

```ts
import type { Config } from 'tailwindcss'

const config: Config = {
  content: [
    './pages/**/*.{js,ts,jsx,tsx,mdx}',
    './components/**/*.{js,ts,jsx,tsx,mdx}',
    './app/**/*.{js,ts,jsx,tsx,mdx}',
  ],
  theme: {
    extend: {
      colors: {
        background: 'var(--background)',
        foreground: 'var(--foreground)',
      },
    },
  },
  plugins: [],
}

export default config
```

---

## FILE 6 — `app/globals.css`

```css
@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  --background: #ffffff;
  --foreground: #171717;
}

@media (prefers-color-scheme: dark) {
  :root {
    --background: #0a0a0a;
    --foreground: #ededed;
  }
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html,
body {
  max-width: 100vw;
  overflow-x: hidden;
}

body {
  color: var(--foreground);
  background: var(--background);
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  -webkit-font-smoothing: antialiased;
}
```

---

## FILE 7 — `app/layout.tsx`

```tsx
import type { Metadata } from 'next'
import './globals.css'

export const metadata: Metadata = {
  title: 'My App',
  description: 'Generated by VIAN',
}

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode
}>) {
  return (
    <html lang="en">
      <body>{children}</body>
    </html>
  )
}
```

---

## FILE 8 — `app/page.tsx`

```tsx
export default function Page() {
  return (
    <main
      style={{
        minHeight: '100vh',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        background: '#0a0a0a',
        flexDirection: 'column',
        gap: '12px',
      }}
    >
      <div
        style={{
          width: '8px',
          height: '8px',
          borderRadius: '50%',
          background: '#3b82f6',
          animation: 'pulse 1.4s ease-in-out infinite',
        }}
      />
      <p
        style={{
          color: '#888888',
          fontSize: '13px',
          fontFamily: 'monospace',
        }}
      >
        Generating your app...
      </p>
      <style>{`
        @keyframes pulse {
          0%, 100% { opacity: 1; transform: scale(1); }
          50% { opacity: 0.4; transform: scale(0.75); }
        }
      `}</style>
    </main>
  )
}
```

> This renders immediately when Next.js boots.
> Shows a pulsing blue dot + "Generating your app..."
> AI will overwrite this with the real page content.
> Uses inline styles (not Tailwind) so it works before CSS compiles.

---

## FILE 9 — `lib/utils.ts`

```ts
import { type ClassValue, clsx } from 'clsx'

export function cn(...inputs: ClassValue[]) {
  return clsx(inputs)
}

export function formatDate(date: string | Date): string {
  return new Intl.DateTimeFormat('en-US', {
    month: 'long',
    day:   'numeric',
    year:  'numeric',
  }).format(new Date(date))
}

export function slugify(text: string): string {
  return text
    .toLowerCase()
    .trim()
    .replace(/[^a-z0-9\s-]/g, '')
    .replace(/\s+/g, '-')
    .replace(/-+/g, '-')
}
```

---

## HOW TO PLANT THESE FILES

In your `useGeneration.ts` hook, plant all boilerplate files
BEFORE calling the AI generation API:

```typescript
// hooks/useGeneration.ts

import { BOILERPLATE_FILES } from '@/lib/boilerplate'

export function useGeneration() {
  const { writeFile, install, startDev } = useWebContainer()

  async function generate(prompt: string, model: string) {

    // ─── STEP 1: Plant all boilerplate files first ──────────────
    for (const file of BOILERPLATE_FILES) {
      await writeFile(file.path, file.content)
    }

    // ─── STEP 2: Start npm install immediately ───────────────────
    // Don't wait — runs in background while AI generates
    install()

    // ─── STEP 3: Call AI generation API (SSE stream) ────────────
    const response = await fetch('/api/generate', {
      method:  'POST',
      headers: { 'Content-Type': 'application/json' },
      body:    JSON.stringify({ prompt, model }),
    })

    const reader  = response.body!.getReader()
    const decoder = new TextDecoder()

    while (true) {
      const { done, value } = await reader.read()
      if (done) break

      const lines = decoder.decode(value).split('\n').filter(Boolean)

      for (const line of lines) {
        if (!line.startsWith('data: ')) continue

        const event = JSON.parse(line.slice(6))

        if (event.type === 'file') {
          // AI overwrites boilerplate files with real content
          await writeFile(event.path, event.content)

          // Start dev server the moment real page.tsx lands
          if (event.path === 'app/page.tsx') {
            startDev()
          }
        }
      }
    }
  }

  return { generate }
}
```

---

## BOILERPLATE FILES CONSTANT

Store all boilerplate as a typed constant so it's always consistent:

```typescript
// lib/boilerplate.ts

export interface BoilerplateFile {
  path:    string
  content: string
}

export const BOILERPLATE_FILES: BoilerplateFile[] = [
  {
    path: 'package.json',
    content: JSON.stringify({
      name: 'vian-app',
      version: '0.1.0',
      private: true,
      scripts: {
        dev:   'next dev',
        build: 'next build',
        start: 'next start',
        lint:  'next lint',
      },
      dependencies: {
        next:           '14.2.5',
        react:          '18.3.1',
        'react-dom':    '18.3.1',
        clsx:           '2.1.1',
        'lucide-react': '0.395.0',
      },
      devDependencies: {
        '@types/node':      '20.14.2',
        '@types/react':     '18.3.3',
        '@types/react-dom': '18.3.0',
        autoprefixer:       '10.4.19',
        postcss:            '8.4.38',
        tailwindcss:        '3.4.4',
        typescript:         '5.4.5',
      },
    }, null, 2),
  },

  {
    path: 'next.config.js',
    content: `/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  async headers() {
    return [
      {
        source: '/(.*)',
        headers: [
          { key: 'Cross-Origin-Embedder-Policy', value: 'require-corp' },
          { key: 'Cross-Origin-Opener-Policy',   value: 'same-origin'  },
        ],
      },
    ]
  },
}
module.exports = nextConfig`,
  },

  {
    path: 'tsconfig.json',
    content: JSON.stringify({
      compilerOptions: {
        target:            'ES2017',
        lib:               ['dom', 'dom.iterable', 'esnext'],
        allowJs:           true,
        skipLibCheck:      true,
        strict:            true,
        noEmit:            true,
        esModuleInterop:   true,
        module:            'esnext',
        moduleResolution:  'bundler',
        resolveJsonModule: true,
        isolatedModules:   true,
        jsx:               'preserve',
        incremental:       true,
        plugins:           [{ name: 'next' }],
        paths:             { '@/*': ['./*'] },
      },
      include:  ['next-env.d.ts', '**/*.ts', '**/*.tsx', '.next/types/**/*.ts'],
      exclude:  ['node_modules'],
    }, null, 2),
  },

  {
    path: 'postcss.config.js',
    content: `module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}`,
  },

  {
    path: 'tailwind.config.ts',
    content: `import type { Config } from 'tailwindcss'

const config: Config = {
  content: [
    './pages/**/*.{js,ts,jsx,tsx,mdx}',
    './components/**/*.{js,ts,jsx,tsx,mdx}',
    './app/**/*.{js,ts,jsx,tsx,mdx}',
  ],
  theme: { extend: {} },
  plugins: [],
}

export default config`,
  },

  {
    path: 'app/globals.css',
    content: `@tailwind base;
@tailwind components;
@tailwind utilities;

* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }`,
  },

  {
    path: 'app/layout.tsx',
    content: `import type { Metadata } from 'next'
import './globals.css'

export const metadata: Metadata = {
  title: 'My App',
  description: 'Generated by VIAN',
}

export default function RootLayout({
  children,
}: Readonly<{ children: React.ReactNode }>) {
  return (
    <html lang="en">
      <body>{children}</body>
    </html>
  )
}`,
  },

  {
    path: 'app/page.tsx',
    content: `export default function Page() {
  return (
    <main style={{
      minHeight: '100vh',
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center',
      background: '#0a0a0a',
      flexDirection: 'column',
      gap: '12px',
    }}>
      <div style={{
        width: '8px',
        height: '8px',
        borderRadius: '50%',
        background: '#3b82f6',
        animation: 'pulse 1.4s ease-in-out infinite',
      }} />
      <p style={{ color: '#888888', fontSize: '13px', fontFamily: 'monospace' }}>
        Generating your app...
      </p>
      <style>{\`
        @keyframes pulse {
          0%, 100% { opacity: 1; transform: scale(1); }
          50% { opacity: 0.4; transform: scale(0.75); }
        }
      \`}</style>
    </main>
  )
}`,
  },

  {
    path: 'lib/utils.ts',
    content: `import { type ClassValue, clsx } from 'clsx'

export function cn(...inputs: ClassValue[]) {
  return clsx(inputs)
}`,
  },
]
```

---

## GENERATION ORDER — AI FILES

After boilerplate is planted, AI generates files in this exact order.
The AI MUST follow this sequence. Never deviate.

```
BOILERPLATE (planted before AI starts):
  ✓ package.json
  ✓ next.config.js
  ✓ tsconfig.json
  ✓ postcss.config.js
  ✓ tailwind.config.ts
  ✓ app/globals.css
  ✓ app/layout.tsx
  ✓ app/page.tsx       ← shows "Generating..." placeholder
  ✓ lib/utils.ts

AI GENERATES (overwrites in this order):
  1.  app/globals.css         ← AI may add fonts, CSS variables
  2.  app/layout.tsx          ← AI adds proper metadata, providers
  3.  tailwind.config.ts      ← AI adds custom colors/fonts if needed
  4.  app/page.tsx            ← AI overwrites with real UI ← triggers startDev()
  5.  components/[Name].tsx   ← all components
  6.  lib/[name].ts           ← utilities, hooks, helpers
  7.  app/[route]/page.tsx    ← any additional pages
  8.  app/[route]/layout.tsx  ← any nested layouts
```

---

## CHECKLIST — Before Calling AI

```
□ package.json written to WebContainer root
□ next.config.js written (with COOP/COEP headers)
□ tsconfig.json written
□ postcss.config.js written
□ tailwind.config.ts written
□ app/globals.css written (with @tailwind directives)
□ app/layout.tsx written (valid html/body structure)
□ app/page.tsx written (shows loading placeholder)
□ lib/utils.ts written
□ npm install triggered (running in background)
□ THEN call /api/generate SSE endpoint
□ When AI writes app/page.tsx → call startDev()
□ When server-ready fires → set iframe.src = url
```

---

## COMMON ERRORS AND FIXES

| Error | Cause | Fix |
|---|---|---|
| "Couldn't find pages or app directory" | `app/` not at root | Write to `app/page.tsx` not `apps/web/app/page.tsx` |
| Blank white screen | CSS not loaded | Check `app/globals.css` has `@tailwind base` |
| Tailwind classes not working | postcss missing | Make sure `postcss.config.js` exists |
| npm install hangs | Version ranges like `^14` | Use exact versions like `14.2.5` |
| "Cannot find module clsx" | Missing dependency | Add `clsx` to package.json dependencies |
| COOP error in console | Missing headers | Add COOP/COEP to `next.config.js` |
| WebContainer won't boot | Wrong page context | Must boot on HTTPS page with correct headers |
| Preview stays loading | server-ready never fires | Check `next dev` is running and port 3000 is open |

---

*VIAN Boilerplate — Plant first. Generate second. Preview always works.*